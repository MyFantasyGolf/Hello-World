{"version":3,"sources":["../../../src/db/resultsApi.js"],"names":["isNil","require","conn","moment","saveTourSchedule","schedule","startDate","date","start","db","coll","collection","findOneAndUpdate","year","title","key","toLowerCase","replace","upsert","err","console","log","stack","getSchedules","season","find","toArray","results","getRoster","parseInt","players","saveRoster","roster","saveResults","forEach","result","$set","module","exports"],"mappings":"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","file":"resultsApi.js","sourcesContent":["const isNil = require('lodash/isNil');\nconst conn = require('./connection');\nconst moment = require('moment');\n\nconst saveTourSchedule = async (schedule) => {\n  const startDate = moment(schedule.date.start, 'MM/DD/YYYY');\n\n  const db = await conn.db;\n  const coll = db.collection('schedules');\n\n  try {\n    coll.findOneAndUpdate(\n      { year: schedule.year, title: schedule.title },\n      { ...schedule, key: schedule.title.toLowerCase().replace(/ /g, '') },\n      { upsert: true }\n    );\n  }\n  catch(err) {\n    console.log(err.stack);\n  }\n};\n\nconst getSchedules = async (season) => {\n  const db = await conn.db;\n  const coll = db.collection('schedules');\n  const results = await coll.find({year: season}).toArray();\n\n  return results;\n};\n\nconst getRoster = async (season) => {\n  const db = await conn.db;\n  const coll = db.collection('players');\n  const results = await coll.find({year: parseInt(season)}).toArray();\n\n  return results[0].players;\n};\n\nconst saveRoster = async (season, roster) => {\n  const db = await conn.db;\n  const coll = db.collection('players');\n\n  try {\n    coll.findOneAndUpdate(\n      { year: season },\n      { ...roster, year: season },\n      { upsert: true }\n    );\n  }\n  catch( err ) {\n    console.log(err.stack);\n  }\n};\n\nconst saveResults = async (schedule, results) => {\n  const db = await conn.db;\n  const coll = db.collection('schedules');\n\n  try {\n    results.forEach( (result) => {\n\n      coll.findOneAndUpdate(\n        { year: schedule.year, key: schedule.key },\n        { $set: { [`results.${result.key}`]: { ...result } }},\n        { upsert: true }\n      );\n    });\n  }\n  catch(err) {\n    console.log(err.stack);\n  }\n};\n\nmodule.exports = {\n  saveTourSchedule,\n  getSchedules,\n  saveResults,\n  getRoster,\n  saveRoster\n};\n"]}